µC/OS-II

# 任务控制块TCB

任务控制块 OS_TCB是描述一个任务的核心数据结构，存放了各种管理信息，包括任务堆栈指针，任务的状态、优先级，任务链表指针等

OSTCBStkPtr：指向当前任务栈顶的指针
每个任务可以有自己的栈，栈的容量可以是任意的
OSTCBStkBottom：指向任务栈底的指针
OSTCBStkSize：栈的容量用可容纳的指针数目而不是字节数（Byte）来表示

所有的任务控制块分属于两条不同的链表

单向的空闲链表（头指针为OSTCBFreeList）

双向的使用链表（头指针为OSTCBList）

OSTCBNext、OSTCBPrev：用于将任务控制块插入到空闲链表或
使用链表中每个任务的任务控制块在任务创建的时候被链接到使用链表中，在任务删除的时候从链表中被删除

双向连接的链表使得任一成员都能快速插入或删除

所有的任务控制块都被放置在任务控制块列表数组OSTCBTbl[]中
系统初始化时，所有TCB被链接成空闲的单向链表，头指针为
OSTCBFreeList
当创建一个任务后，就把OSTCBFreeList所指向的TCB赋给了该任
务，并将它加入到使用链表中，然后把OSTCBFreeList指向空闲链
表中的下一个结点

# 任务就绪表

每个任务的就绪态标志放入在就绪表中

就绪表中有两个变量

OSRdyGrp：

在OSRdyGrp中，任务按优先级分组，8个任务为一组

OSRdyGrp中的每一位表示8组任务中每一组中是否有进入就绪态的任务

OSRdyTbl[ ]：

任务进入就绪态时，就绪表OSRdyTbl[ ]中的相应元素的相应位也置位

# 任务的调度

μC/OS-II是可抢占实时多任务内核，总是运行就绪任务中优先级最高的那一个

μC/OS-II中不支持时间片轮转法，每个任务的优先级不一样且是唯一的，所以任务调度的工作就是：查找处于就绪态的最高优先级的任务并进行上下文切换

μC/OS-II任务调度所花的时间为常数，与应用程序中建立的任务数无关

# 调度器

确定哪个任务的优先级最高，应该选择哪个任务去运行，这部分的工作是由调度器（Scheduler）来完成的

任务级的调度是由函数OSSched()完成的

中断级的调度是由另一个函数OSIntExt()完成的

# freeRtos任务链表

任务链表：xLIST即根节点，可以是就绪链表、阻塞链表、挂起链表等链表中的节点：每个红框为一个节点，通过pvOwner与任务控制块联系到一起，通过pvContainer挂载到就绪、阻塞、挂起链表上






