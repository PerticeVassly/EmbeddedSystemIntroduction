# 嵌入式软件运行流程

* 上电复位，板级初始化阶段

* 系统引导/升级阶段

* 系统初始化阶段

* 应用初始化阶段

* 多应用运行阶段

# BSP

BSP全称“板级支持包”（Board Support Packages），是介于主板硬件和操作系统中驱动层程序之间的一层，一般认为它属于操作系统一部分，主要是实现对操作系统的支持，为上层的驱动程序提供访问硬件设备寄存器的函数包，使之能够更好的运行于硬件主板

BSP是用于特定硬件平台的一组软件组件，通常包括启动代码、驱动
程序和其他与硬件相关的软件库

## 职责和组成


职责：

提供对特定硬件平台的支持，使操作系统能够在该平台上运行

包含初始化代码（如启动代码和引导加载程序）和硬件抽象层（HAL）

集成各种驱动程序，确保操作系统能够正确识别和使用硬件功能

组成：

启动代码：负责系统上电后的硬件初始化，如设置时钟、初始化存储器等

硬件抽象层（HAL）：提供硬件接口的抽象层

设备驱动：针对特定硬件的驱动程序

示例：

用于特定单片机或开发板的BSP，如STM32的BSP包，包含启动代码、时钟配置、外设驱动等

# 硬件抽象层（HAL, HardWare Abstraction Layer）

定义： 

HAL是介于底层硬件和上层软件之间的一层抽象层，用于隐藏
硬件的具体实现细节，提供统一的接口

职责：

抽象硬件细节，提供易于使用的API

提高代码的可移植性，使得上层应用和中间件无需关心底层硬件的具体实现

通常由硬件厂商提供，帮助开发者快速开发和移植应用

组成：

各种外设的抽象层接口函数，例如GPIO、UART、I2C、SPI等示例：

STM32 HAL库，提供了对STM32系列微控制器外设的抽象和访问

# BSP和BIOS/UEFI的区别

BIOS主要是负责在电脑开启时检测、初始化系统设备（设置栈指针，中断分配，内存初始化..）、装入操作系统并调度操作系统向硬件发出的指令； UEFI,“统一的可扩展固件接口”, 旨在代替BIOS, 提高软件互操作性和解决BIOS的局限性

BSP是和操作系统绑在一起运行，尽管BSP的开始部分和BIOS所做的工作类似，但是 BSP还包含和系统有关的基本驱动

BIOS程序是用户不能更改，编译编程的，只能对参数进行修改设置，但是程序员还可以编程修改BSP，在BSP中任意添加一些和系统无关的驱动或程序，甚至可以把上层开发的统统放到BSP中 

# BootLoader

嵌入式系统中的 OS 启动加载程序

引导加载程序

包括固化在固件(firmware)中的 boot 代码(可选)，和 Boot Loader两大部分

是系统加电后运行的第一段软件代码

实际上是裸机程序

# 单阶段和多阶段的BootLoader

多阶段的 Boot Loader

提供更为复杂的功能，以及更好的可移植性

从固态存储设备上启动的 Boot Loader 大多都是 2 阶段的启动过程BOOTLOADER一般分为2部分

汇编部分执行简单的硬件初始化

C语言部分负责复制数据,设置启动参数,串口通信等功能

BOOTLOADER的生命周期

1. 初始化硬件,如设置UART(至少设置一个),检测存储器等

2. 设置启动参数,告诉内核硬件的信息,如用哪个启动界面,波特率

3. 跳转到操作系统的首地址

4. 消亡